<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>게시판 로그인 페이지</title>
<meta name="viewport" 
	content="user-scalable=no, initial-scale=1, maximum-scale=1, 
	minimum-scale=1, width=device-width">
<link rel="stylesheet" href="css/jquery.mobile-1.4.5.css">
<script type="text/javascript" src="js/jquery-1.12.4.min.js"></script>
<script>
	var REST_SERVICE_URI = 'http://localhost:8082/UML01Board/';
	
	$(document).on('pagecreate', function() {

		$('#btnLogin').unbind();
		$('#btnLogin').click(function(e) {
			// 기본 이벤트 동작하지 않도록 하기
			e.preventDefault();
	
			// form 가져오기
			var form = $('#frmLogin')[0];
	
			// FormData 생성
			var formData = new FormData(form);
	
			// 두번 실행 방지를 위해 버튼 비활성
			$('#btnLogin').prop('disabled', true);
			
			$.ajax({
				type: 'post',
				url: REST_SERVICE_URI + '/board',
				data: false,
				contentType: false,
				cache: false,
				success: function(data, testStatus, xhr){
					$('#btnLogin').prop('disabled', false);
					alert(data);

					var location = xhr.getResponseHeader('Location');

					sessionStorage.setItem('base64Credentials', data);
					sessionStorage.setItem('location', location);
					$.mobile.changePage('home.html');
				},
				error: function(error){
					$('#btnLogin').prop('disabled', false);
					alert(error);
				}
			});
		});
	});

	$(document).on('pagechange', function(){
		var currentUrl = $(location).attr('href');
		var index = currentUrl.lastIndexOf('/');
		var currentUrl = href.subString(index);

		if (currentUrl.startsWidth('/home.html')) {
			$.ajax({
				type: 'get',
				url: sessionStorage.getItem('location'),
				authority: sessionStorage.getItem('base64Credentials'),
				contentType: 'application',
				dataType: 'json',
				success: function(data, textStatus, xhr){
					console.log(JSON.stringify(data));
					$('#email').html();
					$('#name').html();
					$('#authority').attr('src');
					$('#avatar').html();
				}
				error: function(error) {
					alert(error);
				}
			});
		}
	});
</script>
<script type="text/javascript" src="js/jquery.mobile-1.4.5.js"></script>
</head>
<body>
	<div data-role="page">
		<div data-role="header">
			<h1>게시판 로그인</h1>
		</div>
		<div data-role="content">
			<form method="post">
				<div data-role="fieldcontain">
					<label for="email">이메일</label>
					<input type="email" name="email" id="email">
				</div>
				<div data-role="fieldcontain">
					<label for="password">비밀번호</label>
					<input type="password" name="password" id="password">
				</div>
				
				<div class="ui-grid-a">
					<div class="ui-block-a">
						<a href="#" data-role="button" id="btnLoign">회원가입</a>
					</div>
					<div class="ui-block-b">
						<a href="#" data-role="button" id="btnLoign">로그인</a>
					</div>
				</div>
			</form>
		</div>
	</div>
</body>
</html>